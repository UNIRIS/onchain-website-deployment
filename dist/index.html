<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uniris OnChain Website</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
</head>
<body>
    <div class="container-fluid">

        <div class="row ">
            <div class="col col-sm-3">
                <form id="form">
                    <div class="mb-3">
                        <label for="endpoint" class="form-label">Node endpoint</label>
                        <input type="text" class="form-control" id="endpoint" value="http://localhost:4000">
                    </div>
                    <div class="mb-3">
                        <label for="originSeed" class="form-label">Origin seed</label>
                        <input type="password" class="form-control" id="originSeed">
                    </div>
                    <div class="mb-3 custom-file">
                        <input type="file" class="custom-file-input" id="file">
                        <label class="custom-file-label" for="file">Choose a file</label>
                    </div>
                    <div class="mb-3">
                        <label for="seed" class="form-label">TransactionChain seed</label>
                        <input type="password" class="form-control" id="seed">
                    </div>
                    <div class="mb-3">
                        <label for="index" class="form-label">TransactionChain Index</label>
                        <input type="number" class="form-control" id="index" min="0" value="0">
                    </div>
                    <button type="submit" class="btn btn-secondary">Generate the transaction</button>
                </form>
                <div id="output" style="display: none">
                    <p>Address: <span id="tx_address"></span></p>
                    <button type="button" id="btn_send_tx" class="btn btn-primary">Deploy</button>
                    <div class="spinner-border" role="status" id="process" style="display: none; margin-top: 20px">
                        <span class="sr-only">Loading...</span>
                      </div>
                    </div>  
                    <div class="alert alert-primary alert-dismissible fade show d-none mt-5" id="success-alert">
                        Transaction submitted to the network
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="alert alert-danger alert-dismissible fade show d-none" id="error-alert">
                        <h4 class="alert-heading">Something went wrong</h4>
                        <hr>
                        <p class="mb-0" id="errors"></p>
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                </div>
                    
            <div class="col pt-5 min-vh-100" style="background: #81889c;">
                <div class="row">
                    <div class="col">
                        <table class="table table-striped table-hover caption-top" style="background: #fff">
                            <caption style="color: #fff">Third Party Libraries</caption>
                            <thead >
                                <tr>
                                    <th>File</th>
                                    <th>Seed</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>animate.css</td>
                                    <td>animate_seed</td>
                                </tr>
                                <tr>
                                    <td>bicon.css</td>
                                    <td>bicon_seed</td>
                                </tr>
                                <tr>
                                    <td>bootstrap_min.css</td>
                                    <td>bootstrap_css_seed</td>
                                </tr>
                                <tr>
                                    <td>bootstrap_min.js</td>
                                    <td>bootstrap_js_seed</td>
                                </tr>
                                <tr>
                                    <td>font-awesome.css</td>
                                    <td>fontawesome_seed</td>
                                </tr>
                                <tr>
                                    <td>carousel.css</td>
                                    <td>carousel_seed</td>
                                </tr>
                                <tr>
                                    <td>jquery.min.js</td>
                                    <td>jquery_seed</td>
                                </tr>
                                <tr>
                                    <td>magnific-popup.css</td>
                                    <td>magnificpopup_css_seed</td>
                                </tr>
                                <tr>
                                    <td>jquery.magnificpopup.min.js</td>
                                    <td>magnificpopup_js_seed</td>
                                </tr>
                                <tr>
                                    <td>own.carousel.min.css</td>
                                    <td>owlcarousel_css_seed</td>
                                </tr>
                                <tr>
                                    <td>own.carousel.min.js</td>
                                    <td>owlcarousel_js_seed</td>
                                </tr>
                                <tr>
                                    <td>popper.min.js</td>
                                    <td>popper_seed</td>
                                </tr>
                                <tr>
                                    <td>wow.min.js</td>
                                    <td>wow_seed</td>
                                </tr>
                                <tr>
                                    <td>jquery.countdown.min.js</td>
                                    <td>jquerycountdown_seed</td>
                                </tr>
                                <tr>
                                    <td>particles.js</td>
                                    <td>particles_seed</td>
                                </tr>
                                <tr>
                                    <td>d3.min.js</td>
                                    <td>d3_seed</td>
                                </tr>
                                <tr>
                                    <td>d3.queue.min.js</td>
                                    <td>d3queue_seed</td>
                                </tr>
                                <tr>
                                    <td>d3_topo_json.min.js</td>
                                    <td>d3topojson_seed</td>
                                </tr>
                                <tr>
                                    <td>form_validator.min.js</td>
                                    <td>formvalidator_seed</td>
                                </tr>
                                <tr>
                                    <td>world-110m.json</td>
                                    <td>world-110_seed</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="col">
                        <table class="table caption-top table-striped table-hover" style="background: #fff">
                            <caption style="color: #fff">uniris.io</caption>
                            <thead>
                                <tr>
                                    <th>File</th>
                                    <th>Seed</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>main.css</td>
                                    <td>uniris_css_seed</td>
                                </tr>
                                <tr>
                                    <td>main.js</td>
                                    <td>uniris_js_seed</td>
                                </tr>
                                <tr>
                                    <td>biometric_animation.js</td>
                                    <td>uniris_biometricanim_seed</td>
                                </tr>
                                <tr>
                                    <td>blockchain_animation.js</td>
                                    <td>uniris_blockchainanim_seed</td>
                                </tr>
                                <tr>
                                    <td>index.html</td>
                                    <td>uniris_index_seed</td>
                                </tr>
                                <tr>
                                    <td>index_fr.html</td>
                                    <td>uniris_index_fr_seed</td>
                                </tr>
                                <tr>
                                    <td>index_ru.html</td>
                                    <td>uniris_index_ru_seed</td>
                                </tr>
                                <tr>
                                    <td>UNIRIS-White-Paper.pdf</td>
                                    <td>uniris_whitepaper_seed</td>
                                </tr>
                                <tr>
                                    <td>UNIRIS-White-Paper-FR.pdf</td>
                                    <td>uniris_whitepaper_fr_seed</td>
                                </tr>
                                <tr>
                                    <td>UNIRIS-YellowPaper-Season1-Network.pdf</td>
                                    <td>uniris_yellowpaper_s1_seed</td>
                                </tr>
                                <tr>
                                    <td>UNIRIS-YellowPaper-Saison1-Reseau.pdf</td>
                                    <td>uniris_yellowpaper_s1_fr_seed</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha2/js/bootstrap.bundle.min.js" integrity="sha384-BOsAfwzjNJHrJ8cZidOg56tcQWfp6y72vEJ8xQ9w6Quywb24iOsW913URv1IS4GD" crossorigin="anonymous"></script>
    <script src="app.js"></script>
    <script>
        
        let content = "";
        let tx;

        document.querySelector('#file').addEventListener('change', (event) => {
            const fileList = event.target.files;

            let fr = new FileReader()
            fr.onload = function (e) {
                content = e.target.result
            }
            fr.readAsArrayBuffer(fileList[0])
        });

        document.querySelector("#form").onsubmit = (e) => {
            e.preventDefault()

            $("#success-alert").addClass('d-none')
            $("#error-alert").addClass('d-none')
            $("#tx_address").text('')

            const originSeed = document.querySelector("#originSeed").value
            const seed = document.querySelector("#seed").value
            const index = parseInt(document.querySelector("#index").value)

            tx = generateTransaction(seed, index, content)
            document.querySelector("#tx_address").innerText = tx.address.toString('hex')
            document.querySelector("#output").style.display = "block"
            $("#btn_send_tx").show()
           
        }

        document.querySelector("#seed").onchange = () => {
            const endpoint = document.querySelector("#endpoint").value;
            const seed = document.querySelector("#seed").value;
            getTransactionIndex(seed, endpoint).then(nb => {
                document.querySelector("#index").value = nb;
            })
        }

        document.querySelector("#btn_send_tx").onclick = () => {
            const endpoint = document.querySelector("#endpoint").value
            document.querySelector("#process").style.display = "block"

            sendTransaction(tx, endpoint).then(() => {
                document.querySelector("#process").style.display = "none"
                $("#success-alert").removeClass('d-none')
                $("#btn_send_tx").hide()
                

            }).catch((e) => {
                document.querySelector("#process").style.display = "none"
                $("#errors").innerText(e)
                $("#error-alert").removeClass('d-none')
                $("#btn_send_tx").hide()
            })
        }
    </script>
</body>
</html>